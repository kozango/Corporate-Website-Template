---
import Layout from '../../layouts/Layout.astro';
import Container from '../../components/Container.astro';
import PageHeader from '../../components/PageHeader.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import MediaSidebar from '../../components/MediaSidebar.astro';
import PaginationControls from '../../components/PaginationControls.astro';
import { getBlogs } from '../../lib/microcms';

// ページネーションの設定
const PER_PAGE = 10;
const currentPage = Number(Astro.url.searchParams.get('page') || '1');

// 記事一覧を取得
const { contents: blogs, totalCount } = await getBlogs({
  offset: (currentPage - 1) * PER_PAGE,
  limit: PER_PAGE,
});

// 人気記事を取得（今はダミーデータ、後で実装）
const popularArticles = blogs.slice(0, 3);

// 総ページ数を計算
const totalPages = Math.ceil(totalCount / PER_PAGE);
---

<Layout title="メディア | Kumono" description="Kumonoのメディアページです。最新の記事や情報をご覧いただけます。">
  <PageHeader
    title="MEDIA"
    subtitle="最新の記事や情報をご覧いただけます"
  />
  
  <Container className="py-12">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="col-span-2">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          {blogs.map((blog) => (
            <ArticleCard blog={blog} />
          ))}
        </div>
        
        <PaginationControls
          currentPage={currentPage}
          totalPages={totalPages}
          baseUrl="/media"
        />
      </div>
      
      <div class="col-span-1">
        <MediaSidebar popularArticles={popularArticles} />
      </div>
    </div>
  </Container>
</Layout>
